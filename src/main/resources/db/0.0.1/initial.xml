<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
		http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">
    <changeSet id="1" author="RusyaAndLyosha">

        <comment>
            Инициализация структуры базы данных.
        </comment>

        <!-- USERS -->
        <createTable tableName="users">
            <column name="id" type="VARCHAR(36)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="email" type="VARCHAR(100)">
                <constraints primaryKey="false" nullable="false" unique="true"/>
            </column>
            <column name="password" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="user_name" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column name="surname" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column name="user_role" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <!--USER_SUBORDINATOR -->
        <createTable tableName="user_subordinator">
            <column name="boss_id" type="VARCHAR(36)">
                <constraints foreignKeyName="fk_user_subordinator_boss" references="users(id)"/>
            </column>
            <column name="subordinator_id" type="VARCHAR(36)">
                <constraints foreignKeyName="fk_user_subordinator_sub" references="users(id)"/>
            </column>
        </createTable>

        <!-- NOTIFICATION -->
        <createTable tableName="notification">
            <column name="id" type="VARCHAR(36)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="request_id" type="VARCHAR(36)"/>
            <column name="watched" type="BOOLEAN"/>
            <column name="user_id" type="VARCHAR(36)">
                <constraints foreignKeyName="fk_notification_user" references="users(id)"/>
            </column>
        </createTable>

        <!-- ACCOMMODATION -->
        <createTable tableName="accommodation">
            <column name="id" type="VARCHAR(36)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="address" type="VARCHAR(100)"/>
            <column name="checkin_time" type="TIMESTAMP"/>
            <column name="checkout_time" type="TIMESTAMP"/>
            <column name="booking_tickets" type="TEXT"/>
        </createTable>

        <!-- OFFICE -->
        <createTable tableName="office">
            <column name="id" type="VARCHAR(36)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="address" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="TEXT"/>
        </createTable>

        <!-- DESTINATION -->
        <createTable tableName="destination">
            <column name="id" type="VARCHAR(36)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="address" type="VARCHAR(36)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="TEXT"/>
            <column name="office_id" type="VARCHAR(36)">
                <constraints foreignKeyName="fk_destination_office" references="office(id)"/>
            </column>
            <column name="seat_place" type="TEXT"/>
        </createTable>

        <!-- TRANSPORTATION -->
        <createTable tableName="transportation">
            <column name="id" type="VARCHAR(36)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="dtype" type="VARCHAR(5)">
                <constraints nullable="false"/>
            </column>
            <column name="start_date" type="TIMESTAMP"/>
            <column name="from_where" type="VARCHAR(50)"/>
            <column name="to_where" type="VARCHAR(50)"/>
            <column name="departure_point" type="VARCHAR(50)"/>
            <column name="recommended_datetime" type="TIMESTAMP"/>
        </createTable>
        
        <!-- REQUEST -->
        <createTable tableName="request">
            <column name="id" type="VARCHAR(36)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="trip_id" type="VARCHAR(36)"/>
            <column name="status" type="VARCHAR(36)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="TEXT"/>
            <column name="worker_id" type="VARCHAR(36)">
                <constraints foreignKeyName="fk_request_user" references="users(id)" nullable="false"/>
            </column>
            <column name="office_id" type="VARCHAR(36)">
                <constraints foreignKeyName="fk_request_office" references="office(id)"/>
            </column>
            <column name="comment" type="TEXT"/>
            <column name="start_date" type="TIMESTAMP"/>
            <column name="end_date" type="TIMESTAMP"/>
            <column name="transport_to" type="VARCHAR(50)"/>
            <column name="transport_from" type="VARCHAR(50)"/>
            <column name="tickets" type="TEXT"/>
        </createTable>
        
        <!-- TRIP -->
        <createTable tableName="trip">
            <column name="id" type="VARCHAR(36)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="request_id" type="VARCHAR(36)">
                <constraints foreignKeyName="fk_trip_request" references="request(id)"/>
            </column>
            <column name="trip_status" type="VARCHAR(10)">
                <constraints nullable="false"/>
            </column>
            <column name="accommodation_id" type="VARCHAR(36)">
                <constraints foreignKeyName="fk_trip_accommodation" references="accommodation(id)"/>
            </column>
            <column name="destination" type="VARCHAR(36)">
                <constraints foreignKeyName="fk_trip_destination" references="destination(id)"/>
            </column>
        </createTable>

        <addForeignKeyConstraint baseTableName="notification" baseColumnNames="request_id"
                                 constraintName="fk_notification_request" referencedTableName="request"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="request" baseColumnNames="trip_id"
                                 constraintName="fk_request_trip" referencedTableName="trip"
                                 referencedColumnNames="id"/>

    </changeSet>
</databaseChangeLog>